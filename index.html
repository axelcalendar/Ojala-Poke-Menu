<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Poke Bar â€“ Online Menu & Builder</title>
  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 UMD + ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <!-- Babel for in-browser JSX transform -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-emerald-50/40">
  <div id="root"></div>

  <script type="text/babel">
    const { useMemo, useState } = React;

    // Presets
    const PRESETS = [
      { name: "El ClÃ¡sico", price: 13 },
      { name: "Bristol", price: 15 },
      { name: "Doramas", price: 15 },
      { name: "Ventahor", price: 14 },
      { name: "Pulp Fiction", price: 15 },
      { name: "Ico", price: 14 },
    ];

    // Custom builder config
    const LIMITS = { base: 1, protein: 1, toppings: 4, sauce: 1, crunchy: 1 };
    const EXTRA_PRICES = { base: 2, protein: 3, toppings: 1.5, sauce: 1, crunchy: 1.5 };
    const BASES = ["Arroz sushi", "Quinoa", "Ensalada"];
    const PROTEINS = [
      "SalmÃ³n (crudo)","SalmÃ³n tataki","SalmÃ³n teriyaki",
      "AtÃºn (crudo)","AtÃºn tataki","Pulpo","Tofu a la plancha","Pollo teriyaki"
    ];
    const TOPPINGS = [
      "Aguacate","Mango","Alga wakame","Edamame","Cebolla caramelizada","Cebolla encurtida",
      "Zanahoria","Calabaza","CalabacÃ­n parrillado","Tomate cherry","Tomate seco","Pepino",
      "Col morada","Philadelphia","Queso feta","Jengibre encurtido","Huevas de pescado"
    ];
    const SAUCES = [
      "Spicy mayonesa","Soja","Soja sin gluten","Salsa sriracha ðŸŒ¶",
      "Salsa de mango","Wasabi cream","Teriyaki","Salsa curry"
    ];
    const CRUNCHY = ["Cebolla crujiente","Pistacho","Almendra","Anacardo","Alga nori crujiente","Mix de semillas"];

    const Section = ({ title, children, hint }) => (
      <section className="mb-6">
        <div className="flex items-end justify-between">
          <h2 className="text-xl font-semibold">{title}</h2>
          {hint && <p className="text-sm text-gray-500">{hint}</p>}
        </div>
        <div className="mt-3 grid gap-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">{children}</div>
      </section>
    );

    const Chip = ({ label, selected, disabled, onClick, extraNote }) => (
      <button
        className={
          "text-left rounded-2xl border px-4 py-3 shadow-sm transition " +
          (selected ? "border-emerald-500 ring-2 ring-emerald-200 bg-white " : "border-gray-200 hover:border-gray-300 bg-white ") +
          (disabled ? "opacity-50 cursor-not-allowed" : "cursor-pointer")
        }
        onClick={onClick}
        disabled={disabled}
        type="button"
      >
        <div className="flex items-center justify-between gap-3">
          <span className="font-medium">{label}</span>
          {selected && <span className="inline-flex h-5 w-5 items-center justify-center rounded-full bg-emerald-500 text-white text-xs">âœ“</span>}
        </div>
        {extraNote && <div className="mt-1 text-xs text-gray-500">{extraNote}</div>}
      </button>
    );

    function App() {
      const [qty, setQty] = useState(1);
      const [selection, setSelection] = useState({ base: [], protein: [], toppings: [], sauce: [], crunchy: [] });
      const [presetOrders, setPresetOrders] = useState([]); // store {name, price}
      const [customerName, setCustomerName] = useState("");

      const basePrice = 13;

      const extras = useMemo(() => {
        const out = {};
        Object.keys(LIMITS).forEach((k) => {
          const over = Math.max(0, (selection[k] || []).length - LIMITS[k]);
          out[k] = over * EXTRA_PRICES[k];
        });
        return out;
      }, [selection]);

      const extrasTotal = Object.values(extras).reduce((a, b) => a + b, 0);
      const bowlSubtotal = basePrice + extrasTotal;

      const presetsTotal = presetOrders.reduce((sum, p) => sum + p.price, 0);
      const customTotal = bowlSubtotal * qty;
      const orderTotal = (customTotal + presetsTotal).toFixed(2);

      const toggle = (group, item) => {
        setSelection((prev) => {
          const exists = prev[group].includes(item);
          const next = exists ? prev[group].filter((i) => i !== item) : [...prev[group], item];
          return { ...prev, [group]: next };
        });
      };

      const reset = () => {
        setSelection({ base: [], protein: [], toppings: [], sauce: [], crunchy: [] });
        setQty(1);
        setPresetOrders([]);
        setCustomerName("");
      };

      const addPreset = (preset) => {
        setPresetOrders([...presetOrders, preset]);
      };

      const shareText = () => {
        const lines = [];
        lines.push(`Nombre del cliente: ${customerName.trim() || "-"}`);
        lines.push(`Recogida en local`);
        lines.push("");

        if (presetOrders.length > 0) {
          lines.push("**Preset Bowls:**");
          const counts = presetOrders.reduce((acc, p) => {
            acc[p.name] = (acc[p.name] || 0) + 1;
            return acc;
          }, {});
          Object.entries(counts).forEach(([name, count]) => {
            lines.push(`${name} Ã—${count}`);
          });
          lines.push(`Subtotal presets: ${presetsTotal.toFixed(2)} â‚¬`);
          lines.push("");
        }

        lines.push("**Custom Bowls:**");
        lines.push(`Cantidad: ${qty}`);
        lines.push(`Base: ${selection.base.join(", ") || "-"}`);
        lines.push(`ProteÃ­na: ${selection.protein.join(", ") || "-"}`);
        lines.push(`Toppings: ${selection.toppings.join(", ") || "-"}`);
        lines.push(`Salsa: ${selection.sauce.join(", ") || "-"}`);
        lines.push(`Crujiente: ${selection.crunchy.join(", ") || "-"}`);
        lines.push(`Precio por custom bowl: ${bowlSubtotal.toFixed(2)} â‚¬`);
        lines.push(`Subtotal custom: ${customTotal.toFixed(2)} â‚¬`);
        lines.push("");
        lines.push(`Total: ${orderTotal} â‚¬`);

        return encodeURIComponent(lines.join("\n"));
      };

      const whatsappHref = `https://wa.me/34666331917?text=${shareText()}`;
      const canSend = customerName.trim().length > 0;

      return (
        <div className="min-h-screen">
          <header className="sticky top-0 z-10 bg-white/80 backdrop-blur border-b">
            <div className="mx-auto max-w-6xl px-4 py-4 flex flex-col gap-2 md:flex-row md:items-center md:justify-between">
              <h1 className="text-2xl font-bold tracking-tight">Poke Bar</h1>
              <div className="flex items-center gap-3">
                <div className="rounded-xl border px-3 py-1.5 bg-white text-sm">
                  Precio base bowl: <span className="font-semibold">{basePrice} â‚¬</span>
                </div>
                <div className="rounded-xl border px-3 py-1.5 bg-white text-sm">
                  Extras: base +{EXTRA_PRICES.base}â‚¬, proteÃ­na +{EXTRA_PRICES.protein}â‚¬, toppings +{EXTRA_PRICES.toppings}â‚¬, salsa +{EXTRA_PRICES.sauce}â‚¬, crujiente +{EXTRA_PRICES.crunchy}â‚¬
                </div>
              </div>
            </div>
          </header>

          <main className="mx-auto max-w-6xl px-4 py-8">
            {/* Preset bowls */}
            <div className="mb-10 grid gap-4 md:grid-cols-3">
              {PRESETS.map((p) => (
                <div key={p.name} className="rounded-2xl border bg-white p-5 shadow-sm">
                  <div className="flex items-center justify-between">
                    <div>
                      <h3 className="text-lg font-semibold">{p.name}</h3>
                      <p className="text-sm text-gray-500">Bowl listo del chef</p>
                    </div>
                    <div className="text-lg font-bold">{p.price} â‚¬</div>
                  </div>
                  <button
                    className="mt-4 w-full rounded-xl border border-emerald-500 bg-emerald-500/10 px-4 py-2 text-emerald-700 hover:bg-emerald-500/15"
                    onClick={() => addPreset(p)}
                  >
                    AÃ±adir al pedido
                  </button>
                </div>
              ))}
            </div>

            {/* Custom builder */}
            <div className="rounded-3xl border bg-white p-6 shadow-sm">
              <div className="mb-6 flex items-start justify-between gap-4">
                <div>
                  <h2 className="text-2xl font-bold">Crea tu poke</h2>
                  <p className="text-gray-500">Elige hasta: 1 base, 1 proteÃ­na, 4 toppings, 1 salsa, 1 crujiente.</p>
                </div>
                <div className="flex items-center gap-2">
                  <label className="text-sm text-gray-600">Cantidad</label>
                  <input
                    type="number"
                    min={1}
                    value={qty}
                    onChange={(e) => setQty(Math.max(1, parseInt(e.target.value || "1")))}
                    className="w-20 rounded-xl border px-3 py-2"
                  />
                </div>
              </div>

              <Section title="Base" hint={`Elige ${LIMITS.base}. Extra +${EXTRA_PRICES.base}â‚¬`}>
                {BASES.map((item) => (
                  <Chip key={item} label={item} selected={selection.base.includes(item)} onClick={() => toggle("base", item)} />
                ))}
              </Section>

              <Section title="ProteÃ­na" hint={`Elige ${LIMITS.protein}. Extra +${EXTRA_PRICES.protein}â‚¬`}>
                {PROTEINS.map((item) => (
                  <Chip key={item} label={item} selected={selection.protein.includes(item)} onClick={() => toggle("protein", item)} />
                ))}
              </Section>

              <Section title="Toppings" hint={`Hasta ${LIMITS.toppings}. Extra +${EXTRA_PRICES.toppings}â‚¬ c/u`}>
                {TOPPINGS.map((item) => (
                  <Chip key={item} label={item} selected={selection.toppings.includes(item)} onClick={() => toggle("toppings", item)} />
                ))}
              </Section>

              <Section title="Salsa" hint={`Elige ${LIMITS.sauce}. Extra +${EXTRA_PRICES.sauce}â‚¬`}>
                {SAUCES.map((item) => (
                  <Chip key={item} label={item} selected={selection.sauce.includes(item)} onClick={() => toggle("sauce", item)} />
                ))}
              </Section>

              <Section title="Crujiente" hint={`Elige ${LIMITS.crunchy}. Extra +${EXTRA_PRICES.crunchy}â‚¬`}>
                {CRUNCHY.map((item) => (
                  <Chip key={item} label={item} selected={selection.crunchy.includes(item)} onClick={() => toggle("crunchy", item)} />
                ))}
              </Section>

              {/* Customer name + Summary */}
              <div className="mt-8 grid gap-6 md:grid-cols-2">
                <div className="rounded-2xl border p-5">
                  <h3 className="mb-3 text-lg font-semibold">Datos y resumen</h3>

                  <label className="block text-sm font-medium mb-1" htmlFor="customerName">
                    Nombre del cliente <span className="text-red-600">*</span>
                  </label>
                  <input
                    id="customerName"
                    type="text"
                    placeholder="Escribe tu nombre"
                    value={customerName}
                    onChange={(e) => setCustomerName(e.target.value)}
                    className="mb-4 w-full rounded-xl border px-3 py-2"
                    required
                  />
                  <p className="text-xs text-gray-500 mb-4">*Pedido para <strong>recogida en local</strong>.</p>

                  {presetOrders.length > 0 && (
                    <div className="mb-3">
                      <p className="font-medium">Preset Bowls:</p>
                      <ul className="list-disc ml-5 text-sm">
                        {presetOrders.map((p, i) => (
                          <li key={i}>{p.name} - {p.price} â‚¬</li>
                        ))}
                      </ul>
                    </div>
                  )}

                  <p className="font-medium">Custom Bowl:</p>
                  <ul className="space-y-1 text-sm">
                    <li><span className="font-medium">Cantidad:</span> x{qty}</li>
                    <li><span className="font-medium">Base:</span> {selection.base.join(", ") || "â€”"}</li>
                    <li><span className="font-medium">ProteÃ­na:</span> {selection.protein.join(", ") || "â€”"}</li>
                    <li><span className="font-medium">Toppings:</span> {selection.toppings.join(", ") || "â€”"}</li>
                    <li><span className="font-medium">Salsa:</span> {selection.sauce.join(", ") || "â€”"}</li>
                    <li><span className="font-medium">Crujiente:</span> {selection.crunchy.join(", ") || "â€”"}</li>
                  </ul>
                </div>

                <div className="rounded-2xl border p-5">
                  <h3 className="mb-3 text-lg font-semibold">Total</h3>
                  <div className="space-y-1 text-sm">
                    <div className="flex justify-between"><span>Subtotal presets</span><span>{presetsTotal.toFixed(2)} â‚¬</span></div>
                    <div className="flex justify-between"><span>Subtotal custom</span><span>{customTotal.toFixed(2)} â‚¬</span></div>
                    <div className="flex justify-between border-t pt-2 text-2xl font-extrabold"><span>Total pedido</span><span>{orderTotal} â‚¬</span></div>
                  </div>

                  <div className="mt-5 flex flex-col gap-2 sm:flex-row">
                    <a
                      href={canSend ? `https://wa.me/34666331917?text=${shareText()}` : "#"}
                      onClick={(e) => { if (!canSend) { e.preventDefault(); alert("Por favor, escribe tu nombre para el pedido de recogida."); } }}
                      aria-disabled={!canSend}
                      className={
                        "flex-1 rounded-xl px-4 py-3 text-center font-semibold text-white " +
                        (canSend ? "bg-emerald-600 hover:bg-emerald-700" : "bg-gray-300 cursor-not-allowed pointer-events-none")
                      }
                      title={canSend ? "Enviar por WhatsApp" : "Escribe tu nombre para continuar"}
                    >
                      Enviar por WhatsApp
                    </a>
                    <button onClick={reset} className="rounded-xl border px-4 py-3 font-medium">Reiniciar</button>
                  </div>
                  <p className="mt-2 text-xs text-gray-500">*WhatsApp enviarÃ¡ el pedido directamente al nÃºmero del restaurante (+34 666 33 19 17).</p>
                </div>
              </div>
            </div>

            <footer className="mt-10 text-center text-sm text-gray-500">
              <p>C/Lepanto 13L Â· Tel. 666 33 19 17 Â· Fuerteventura</p>
              <p className="mt-1">Pedido para <strong>recogida en local</strong>.</p>
            </footer>
          </main>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
